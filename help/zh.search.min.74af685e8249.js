!function(){console.log("[Search] Initializing search functionality");const e="/zh.search-data.min.2cd029023f02.json",t=e=>{const t=[];let n=-1,s=-1;const c=e.toLowerCase();let a=0;for(const e of c){const o=e.codePointAt(0),r=32===o||9===o||10===o||13===o;o>=12352&&o<=12447||o>=12448&&o<=12543||o>=19968&&o<=40959||o>=44032&&o<=55215||o>=131072&&o<=173791?(-1!==n&&(t.push(c.slice(n,s)),n=-1),t.push(e)):r?-1!==n&&(t.push(c.slice(n,s)),n=-1):(-1===n&&(n=a),s=a+e.length),a+=e.length}return-1!==n&&t.push(c.slice(n)),t};let n=null,s=!1,c=null;const a=e=>{const t=e.split(/\s+/).filter(e=>""!==e.trim()),n=t.length;if(n>1)for(let e=1;e<n;e++)t.push(t.slice(0,e+1).join(" "));return t.sort((e,t)=>t.length-e.length)};function o(e,t,n=!1){const s=a(e);let c=t.split(/\s+/).filter(e=>""!==e),o=0,r=c.length-1;if(n){const e=e=>s.some(t=>e.toLowerCase().startsWith(t.toLowerCase())),t=c.map(e);let n=0,a=0;for(let e=0;e<Math.max(c.length-30,0);e++){const s=t.slice(e,e+30).reduce((e,t)=>e+(t?1:0),0);s>=n&&(n=s,a=e)}o=Math.max(a-30,0),r=Math.min(o+60,c.length-1),c=c.slice(o,r)}return`${0===o?"":"..."}${c.map(e=>{for(const t of s)if(e.toLowerCase().includes(t.toLowerCase())){const n=new RegExp(t.toLowerCase(),"gi");return e.replace(n,'<span class="highlight">$&</span>')}return e}).join(" ")}${r===c.length-1?"":"..."}`}function r(e,t){const n=a(e),s=[t];for(;s.length>0;){const e=s.shift(),t=e.nodeType;if(t===Node.TEXT_NODE){let t=e.textContent,s=e.parentElement;for(const c of n){const n=new RegExp(c.toLowerCase(),"gi");if(n.test(t)){const c=document.createElement("span");c.innerHTML=t.replace(n,'<span class="highlight">$&</span>'),s.replaceChild(c,e);break}}}else t===Node.ELEMENT_NODE&&s.push(...e.childNodes)}return t}function l(e){for(;e.firstChild;)e.removeChild(e.firstChild)}console.log("[Search] DOM ready, waiting for FlexSearch...");let i=0;function d(){"undefined"!=typeof FlexSearch&&FlexSearch.Document?(console.log("[Search] FlexSearch is ready"),function(){const a=document.querySelectorAll(".search");a.forEach(a=>async function(a){console.log("[Search] Setting up search element");const i=a.querySelector(".search-container");if(!i)return void console.warn("[Search] No search container found");const d=i.closest(".sidebar"),h=a.querySelector(".search-button"),u=a.querySelector(".search-bar"),f=a.querySelector(".search-layout");if(!h||!u||!f)return void console.warn("[Search] Missing required search elements");const g=document.createElement("div");g.className="results-container",f.appendChild(g);const p="true"===f.dataset.preview;let m,y,w=null,L="";const v=new Map,E=new DOMParser;function S(){i.classList.remove("active"),u.value="",d&&(d.style.zIndex=""),l(g),m&&l(m),f.classList.remove("display-results"),L="",h.focus()}function k(){d&&(d.style.zIndex="1"),i.classList.add("active"),u.focus()}async function C(e){if(!(f&&p&&e&&m))return;const t=e.id,n=await async function(e){if(v.has(e))return v.get(e);const t=c[e],n=t?t.url:`/${e}.html`;try{const t=await fetch(n),s=await t.text();if(!s)throw new Error(`Could not fetch ${n}`);const c=[...E.parseFromString(s,"text/html").getElementsByClassName("popover-hint")];return v.set(e,c),c}catch(t){return console.error(`[Search] Failed to fetch content for ${e}:`,t),[]}}(t).then(e=>e.flatMap(e=>[...r(L,e.cloneNode(!0)).children]));y=document.createElement("div"),y.classList.add("preview-inner"),y.append(...n),m.replaceChildren(y);const s=[...m.getElementsByClassName("highlight")].sort((e,t)=>t.innerHTML.length-e.innerHTML.length);s[0]?.scrollIntoView({block:"start"})}async function x(){if(!s){console.log("[Search] Loading search data from:",e);try{const a=await fetch(e);c=await a.json(),console.log(`[Search] Loaded ${Object.keys(c).length} pages`),n=new FlexSearch.Document({encode:t,document:{id:"id",tag:"tags",index:[{field:"title",tokenize:"forward"},{field:"content",tokenize:"forward"},{field:"tags",tokenize:"forward"}]}});const o=Object.keys(c),r=[];o.forEach((e,t)=>{const s=c[e];r.push(n.addAsync(t,{id:t,slug:e,title:s.title,content:s.content,tags:s.tags||[]}))}),await Promise.all(r),s=!0,console.log("[Search] Index built successfully")}catch(e){console.error("[Search] Failed to load search data:",e)}}}function $({slug:e,title:t,content:n,tags:s}){const a=c[e],o=a?a.url:`/${e}.html`,r=s.length>0?`<ul class="tags">${s.map(e=>`<li><p>#${e}</p></li>`).join("")}</ul>`:"",l=document.createElement("a");return l.classList.add("result-card"),l.id=e,l.href=o,l.innerHTML=`\n        <h3 class="card-title">${t}</h3>\n        ${r}\n        <p class="card-description">${n}</p>\n      `,l.addEventListener("click",e=>{e.altKey||e.ctrlKey||e.metaKey||e.shiftKey||S()}),l.addEventListener("mouseenter",async function(e){if(!e.target)return;w&&w.classList.remove("focus");const t=e.target;t.classList.add("focus"),w=t,await C(t)}),l}p&&(m=document.createElement("div"),m.className="preview-container",f.appendChild(m)),h.addEventListener("click",()=>{k(),x()}),u.addEventListener("input",async function(e){if(!f||!n)return;if(L=e.target.value,f.classList.toggle("display-results",""!==L),!L)return l(g),void(m&&l(m));const t=await n.searchAsync({query:L,limit:8,index:["title","content"]}),s=e=>{const n=t.filter(t=>t.field===e);return 0===n.length?[]:[...n[0].result]},a=[...new Set([...s("title"),...s("content")])].map(e=>function(e,t){const n=Object.keys(c)[t],s=c[n];return{id:t,slug:n,title:o(e,s.title||""),content:o(e,s.content||"",!0),tags:s.tags||[]}}(L,e));await async function(e){if(l(g),0===e.length)g.innerHTML='<a class="result-card no-match">\n          <h3>No results.</h3>\n          <p>Try another search term?</p>\n        </a>',m&&l(m);else if(g.append(...e.map($)),p&&m){const e=g.firstElementChild;e.classList.add("focus"),w=e,await C(e)}}(a)}),document.addEventListener("keydown",function(e){if("k"!==e.key||!e.ctrlKey&&!e.metaKey||e.shiftKey||(e.preventDefault(),k(),x()),("Escape"===e.key||"k"===e.key&&(e.ctrlKey||e.metaKey)&&e.shiftKey)&&(e.preventDefault(),S()),i.classList.contains("active"))if("ArrowUp"===e.key||e.shiftKey&&"Tab"===e.key){e.preventDefault(),w&&w.classList.remove("focus");const t=w?w.previousElementSibling:g.lastElementChild;t&&(t.classList.add("focus"),w=t,C(t))}else if("ArrowDown"===e.key||"Tab"===e.key){e.preventDefault(),w&&w.classList.remove("focus");const t=w?w.nextElementSibling:g.firstElementChild;t&&(t.classList.add("focus"),w=t,C(t))}else"Enter"===e.key&&w&&(e.preventDefault(),w.click())}),i.addEventListener("click",e=>{e.target===i&&S()})}(a)),a.length>0&&console.log(`[Search] Initialized ${a.length} search element(s)`)}()):i<100?(i++,i%10==0&&console.log(`[Search] Waiting for FlexSearch... (${i}/100)`),setTimeout(d,100)):console.error("[Search] FlexSearch failed to load after 10 seconds. Please check the CDN link: https://cdn.jsdelivr.net/npm/flexsearch@0.7.31/dist/flexsearch.bundle.js")}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{d()}):d()}();